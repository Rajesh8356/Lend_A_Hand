<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vendor Dashboard - Lend A Hand</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c5282;
            --primary-light: #4299e1;
            --secondary: #38a169;
            --secondary-light: #68d391;
            --accent: #e53e3e;
            --light: #f7fafc;
            --dark: #2d3748;
            --gray: #a0aec0;
            --gray-light: #e2e8f0;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --radius: 12px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--dark);
            min-height: 100vh;
            display: flex;
        }
        
        .rent-requests-list .card {
            border-left: 4px solid var(--primary);
            transition: all 0.3s ease;
            margin-bottom: 15px;
            padding: 20px;
        }

        .rent-requests-list .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .rent-requests-list .item-badge {
            font-size: 0.8rem;
            padding: 4px 8px;
        }

        .request-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .request-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .request-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        /* Sidebar Navigation */
        .sidebar {
            width: 260px;
            background: var(--primary);
            color: white;
            padding: 20px 0;
            height: 100vh;
            position: fixed;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
        }
        
        .logo {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
        }
        
        .logo h1 {
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo span {
            color: var(--secondary-light);
        }
        
        .nav-links {
            list-style: none;
            padding: 0 15px;
        }
        
        .nav-links li {
            margin-bottom: 5px;
        }
        
        .nav-links a {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            text-decoration: none;
            color: white;
            border-radius: 8px;
            transition: all 0.3s;
            gap: 12px;
            cursor: pointer;
        }
        
        .nav-links a:hover, .nav-links a.active {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .nav-links i {
            width: 20px;
            text-align: center;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 260px;
            padding: 20px 30px;
            transition: margin-left 0.3s ease;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .welcome h2 {
            font-size: 1.8rem;
            color: var(--dark);
            margin-bottom: 5px;
        }
        
        .welcome p {
            color: var(--gray);
        }
        
        .header-actions {
            display: flex;
            gap: 15px;
        }
        
        .notification-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: 1px solid var(--gray-light);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            color: var(--dark);
        }
        
        .notification-btn::after {
            content: '';
            width: 8px;
            height: 8px;
            background: var(--accent);
            border-radius: 50%;
            position: absolute;
            top: 8px;
            right: 8px;
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }
        
        .user-img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary-light);
        }
        
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
        }
        
        .stat-card {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .stat-icon.blue {
            background: rgba(66, 153, 225, 0.2);
            color: var(--primary-light);
        }
        
        .stat-icon.green {
            background: rgba(104, 211, 145, 0.2);
            color: var(--secondary);
        }
        
        .stat-icon.orange {
            background: rgba(237, 137, 54, 0.2);
            color: #ed8936;
        }
        
        .stat-icon.red {
            background: rgba(245, 101, 101, 0.2);
            color: #f56565;
        }
        
        .stat-info h3 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        
        .stat-info p {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        /* Content Sections */
        .content-section {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            display: none;
        }
        
        .content-section.active {
            display: block;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .section-header h2 {
            font-size: 1.5rem;
            color: var(--dark);
        }
        .btn-warning {
    background: #ed8936;
    color: white;
}

.btn-warning:hover {
    background: #f6ad55;
}

.status-pending { background: #feebcb; color: #b45309; }
.status-approved { background: #c6f6d5; color: #2f855a; }
.status-completed { background: #bee3f8; color: #2c5282; }
.status-rejected { background: #fed7d7; color: #c53030; }
        
        /* Items Grid */
        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }
        
        .item-card {
            border: 1px solid var(--gray-light);
            border-radius: var(--radius);
            overflow: hidden;
            transition: all 0.3s;
            background: white;
        }
        
        .item-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .item-img {
            height: 180px;
            background: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray);
            overflow: hidden;
            position: relative;
        }
        
        .item-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .item-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .badge-available {
            background: #c6f6d5;
            color: #2f855a;
        }
        
        .badge-unavailable {
            background: #fed7d7;
            color: #c53030;
        }
        
        .badge-maintenance {
            background: #feebcb;
            color: #b45309;
        }
        
        .item-info {
            padding: 15px;
        }
        
        .item-info h3 {
            margin-bottom: 10px;
            color: var(--dark);
            font-size: 1.2rem;
        }
        
        .item-info p {
            color: var(--gray);
            font-size: 0.9rem;
            margin-bottom: 8px;
        }
        
        .item-price {
            font-size: 1.3rem;
            color: var(--secondary);
            font-weight: 700;
            margin: 10px 0;
        }
        
        .item-meta {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            color: var(--gray);
            font-size: 0.85rem;
        }
        
        .item-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            gap: 10px;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 0.85rem;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-light);
        }
        
        .btn-success {
            background: var(--secondary);
            color: white;
        }
        
        .btn-success:hover {
            background: var(--secondary-light);
        }
        
        .btn-danger {
            background: var(--accent);
            color: white;
        }
        
        .btn-danger:hover {
            background: #fc8181;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: var(--radius);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .modal-header {
            padding: 20px 25px;
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            font-size: 1.4rem;
            color: var(--dark);
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }
        
        .modal-body {
            padding: 25px;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--gray-light);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .form-control:focus {
            border-color: var(--primary-light);
            outline: none;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.2);
        }
        
        .form-row {
            display: flex;
            gap: 15px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .modal-footer {
            padding: 20px 25px;
            border-top: 1px solid var(--gray-light);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        /* Table Styles */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            min-width: 600px;
        }
        
        .data-table th, .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .data-table th {
            background-color: var(--gray-light);
            font-weight: 600;
        }
        
        .data-table tr:hover {
            background-color: #f9fafb;
        }
        
        .table-container {
            overflow-x: auto;
            width: 100%;
        }
        
        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--secondary);
            color: white;
            padding: 15px 25px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            z-index: 3000;
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        /* Review Styles */
        .review-card {
            border: 1px solid var(--gray-light);
            border-radius: var(--radius);
            padding: 15px;
            margin-bottom: 15px;
            background: white;
        }
        
        .review-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .reviewer {
            font-weight: 600;
            color: var(--dark);
        }
        
        .review-date {
            color: var(--gray);
            font-size: 0.85rem;
        }
        
        .review-rating {
            color: #f59e0b;
            margin-bottom: 10px;
        }
        
        .review-content {
            color: var(--dark);
            line-height: 1.5;
        }
        
        /* Rent Specific Styles */
        .rent-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .rent-status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .status-rented {
            background: #fed7d7;
            color: #c53030;
        }
        
        .status-available {
            background: #c6f6d5;
            color: #2f855a;
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .sidebar {
                width: 80px;
            }
            
            .sidebar .logo h1 span, 
            .sidebar .nav-links a span {
                display: none;
            }
            
            .sidebar .logo h1 {
                justify-content: center;
            }
            
            .sidebar .nav-links a {
                justify-content: center;
                padding: 15px;
            }
            
            .main-content {
                margin-left: 80px;
            }
        }
        
        @media (max-width: 768px) {
            .dashboard-cards {
                grid-template-columns: 1fr 1fr;
            }
            
            .items-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .data-table {
                display: block;
                overflow-x: auto;
            }
        }
        
        @media (max-width: 576px) {
            .dashboard-cards {
                grid-template-columns: 1fr;
            }
            
            .main-content {
                margin-left: 0;
                padding: 15px;
            }
            
            .sidebar {
                transform: translateX(-100%);
                width: 260px;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .header-actions {
                align-self: stretch;
                justify-content: space-between;
            }
            
            .mobile-menu-btn {
                display: block;
                position: fixed;
                top: 20px;
                left: 20px;
                z-index: 2000;
                background: var(--primary);
                color: white;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: var(--shadow);
            }
        }
        
        .status-pending {
            background: #feebcb;
            color: #b45309;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .status-approved {
            background: #c6f6d5;
            color: #2f855a;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .status-rejected {
            background: #fed7d7;
            color: #c53030;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .status-completed {
            background: #bee3f8;
            color: #2c5282;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .rent-requests-list .card {
            border-left: 4px solid var(--primary);
            transition: all 0.3s ease;
            margin-bottom: 15px;
            padding: 20px;
        }

        .rent-requests-list .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .request-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .request-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .request-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <!-- Mobile Menu Button -->
    <button class="mobile-menu-btn" id="mobileMenuBtn" style="display: none;">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage"></span>
    </div>

    <!-- Sidebar Navigation -->
    <div class="sidebar" id="sidebar">
        <div class="logo">
            <h1><i class="fas fa-hands-helping"></i> <span>Lend A Hand</span></h1>
        </div>
        
        <ul class="nav-links">
            <li><a href="#" class="nav-link active" data-section="dashboard"><i class="fas fa-th-large"></i> <span>Dashboard</span></a></li>
            <li><a href="#" class="nav-link" data-section="equipment"><i class="fas fa-tractor"></i> <span>Equipment</span></a></li>
            <li><a href="#" class="nav-link" data-section="bookings"><i class="fas fa-calendar-alt"></i> <span>Bookings</span></a></li>
            <li><a href="#" class="nav-link" data-section="rent-requests"><i class="fas fa-clipboard-list"></i> <span>Rent Requests</span></a></li>
            <li><a href="#" class="nav-link" data-section="reviews"><i class="fas fa-star"></i> <span>Reviews</span></a></li>
            <li><a href="#" class="nav-link" data-section="settings"><i class="fas fa-cog"></i> <span>Settings</span></a></li>
            <li><a href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> <span>Logout</span></a></li>
        </ul>
    </div>
    
    <!-- Main Content -->
       <!-- Main Content -->
   <!-- Main Content -->
    <div class="main-content" id="mainContent">
       <div class="header">
    <div class="welcome">
        <h2>Welcome, {{ contact_name }}! 👋</h2>
                <p>Manage your equipment and track rentals</p>
                {% if vendor_email %}
                <p style="color: var(--gray); font-size: 0.9rem; margin-top: 5px;">
                    <i class="fas fa-envelope"></i> {{ vendor_email }}
                </p>
                {% endif %}
                {% if business_name %}
                <p style="color: var(--gray); font-size: 0.9rem;">
                    <i class="fas fa-building"></i> {{ business_name }}
                </p>
                {% endif %}
            </div>
            
            <div class="header-actions">
                <div class="notification-btn">
                    <i class="fas fa-bell"></i>
                </div>
                <div class="user-profile">
                    <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80" alt="Vendor" class="user-img">
                    <span>{{ contact_name }}</span>
                </div>
            </div>
        </div>
        <!-- Dashboard Section -->
        <div class="content-section active" id="dashboard-section">
            <!-- Stats Cards -->
            <div class="dashboard-cards">
                <div class="card stat-card">
                    <div class="stat-icon blue">
                        <i class="fas fa-tractor"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalEquipment">0</h3>
                        <p>Total Equipment</p>
                    </div>
                </div>
                
                <div class="card stat-card">
                    <div class="stat-icon green">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="activeBookings">0</h3>
                        <p>Active Bookings</p>
                    </div>
                </div>
                
                <div class="card stat-card">
                    <div class="stat-icon orange">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalCustomers">0</h3>
                        <p>Total Customers</p>
                    </div>
                </div>
                
                <div class="card stat-card">
                    <div class="stat-icon red">
                        <i class="fas fa-star"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="averageRating">0</h3>
                        <p>Average Rating</p>
                    </div>
                </div>
            </div>
            
            <!-- Equipment Category Counts -->
            <div class="card" style="margin-bottom: 30px;">
                <div class="section-header">
                    <h2>Available Equipment by Category</h2>
                </div>
                <div class="dashboard-cards" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                    <div class="card stat-card">
                        <div class="stat-icon blue">
                            <i class="fas fa-tractor"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="tractorCount">0</h3>
                            <p>Available Tractors</p>
                        </div>
                    </div>
                    
                    <div class="card stat-card">
                        <div class="stat-icon green">
                            <i class="fas fa-harvest"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="harvesterCount">0</h3>
                            <p>Available Harvesters</p>
                        </div>
                    </div>
                    
                    <div class="card stat-card">
                        <div class="stat-icon orange">
                            <i class="fas fa-tools"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="ploughCount">0</h3>
                            <p>Available Ploughs</p>
                        </div>
                    </div>
                    
                    <div class="card stat-card">
                        <div class="stat-icon red">
                            <i class="fas fa-tint"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="irrigationCount">0</h3>
                            <p>Available Irrigation</p>
                        </div>
                    </div>
                    
                    <div class="card stat-card">
                        <div class="stat-icon" style="background: rgba(159, 122, 234, 0.2); color: #9f7aea;">
                            <i class="fas fa-ellipsis-h"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="otherCount">0</h3>
                            <p>Available Other</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Recent Equipment Section -->
            <div class="card">
                <div class="section-header">
                    <h2>Recent Equipment</h2>
                    <button class="btn btn-primary view-all-equipment">
                        <i class="fas fa-list"></i> View All
                    </button>
                </div>
                
                <div class="items-grid" id="recentEquipment">
                    <!-- Recent equipment will be loaded here -->
                </div>
            </div>
            
            <!-- Recent Bookings Section -->
            <div class="card" style="margin-top: 30px;">
                <div class="section-header">
                    <h2>Recent Bookings</h2>
                    <button class="btn btn-primary view-all-bookings">
                        <i class="fas fa-list"></i> View All
                    </button>
                </div>
                
                <div class="table-container">
                    <thead>
        <tr>
            <th>ID</th>
            <th>Customer</th>
            <th>Equipment</th>
            <th>Booking Date</th> <!-- Changed from "Period" -->
            <th>Total</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody id="bookingsTable">
                            <!-- Recent bookings will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Equipment Section -->
        <div class="content-section" id="equipment-section">
            <div class="section-header">
                <h2>My Equipment</h2>
                <button class="btn btn-success" id="addEquipmentBtn">
                    <i class="fas fa-plus"></i> Add Equipment
                </button>
            </div>
            
            <div class="items-grid" id="equipmentGrid">
                <!-- Equipment items will be loaded here -->
            </div>
        </div>
        
        <!-- Bookings Section -->
        <div class="content-section" id="bookings-section">
            <div class="section-header">
                <h2>All Bookings</h2>
                <div>
                    <select id="bookingFilter" class="form-control" style="width: auto; display: inline-block; margin-right: 10px;">
                        <option value="all">All Bookings</option>
                        <option value="pending">Pending</option>
                        <option value="confirmed">Confirmed</option>
                        <option value="completed">Completed</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                    <button class="btn btn-primary">
                        <i class="fas fa-download"></i> Export
                    </button>
                </div>
            </div>
            
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Customer</th>
                            <th>Equipment</th>
                            <th>Period</th>
                            <th>Total</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="bookingsTable">
                        <!-- Bookings will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
        
      <!-- Add this modal to your existing vendor dashboard HTML -->
 
<!-- Add this to your vendor dashboard HTML (index.html) -->
<div class="content-section" id="rent-requests-section">
    <div class="section-header">
        <h2>Rent Requests</h2>
        <div>
            <select id="rentRequestFilter" class="form-control" style="width: auto; display: inline-block;">
                <option value="all">All Requests</option>
                <option value="pending">Pending</option>
                <option value="approved">Approved</option>
                <option value="completed">Completed</option>
                <option value="rejected">Rejected</option>
            </select>
        </div>
    </div>
    
    <div id="rentRequestsContainer">
        <!-- No Data Message -->
        <div class="no-data" style="text-align: center; padding: 40px; color: var(--gray); display: none;">
            <i class="fas fa-clipboard-list" style="font-size: 3rem; margin-bottom: 15px;"></i>
            <h3>No Rent Requests</h3>
            <p>You don't have any rent requests yet.</p>
        </div>
        
        <!-- Rent Requests List -->
        <div class="rent-requests-list">
            <!-- Rent request cards will be dynamically inserted here -->
            <!-- DATA STORAGE STRUCTURE:
            Each rent request card will contain:
            - Request ID (data-request-id)
            - Farmer details (name, phone, email)
            - Equipment details (name, ID)
            - Rental dates and duration
            - Pricing information
            - Status and action buttons
            -->
        </div>
    </div>
</div>
        <!-- Reviews Section -->
        <div class="content-section" id="reviews-section">
            <div class="section-header">
                <h2>Customer Reviews</h2>
            </div>
            
            <div class="reviews-list" id="vendorReviewsList">
                <!-- Reviews will be loaded here -->
            </div>
        </div>
        
        <!-- Settings Section -->
        <div class="content-section" id="settings-section">
            <div class="section-header">
                <h2>Settings</h2>
            </div>
            <p style="text-align: center; padding: 40px; color: var(--gray);">
                Settings and configuration options would be displayed here
            </p>
        </div>
    </div>
    
    <!-- Add/Edit Equipment Modal -->
    <div class="modal" id="equipmentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Add New Equipment</h3>
                <button class="close-modal">&times;</button>
            </div>
            
            <div class="modal-body">
                <form id="equipmentForm">
                    <input type="hidden" id="equipmentId">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="equipmentName">Equipment Name *</label>
                            <input type="text" id="equipmentName" class="form-control" placeholder="Enter equipment name" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="equipmentCategory">Category *</label>
                            <select id="equipmentCategory" class="form-control" required>
                                <option value="">Select Category</option>
                                <option value="tractor">Tractor</option>
                                <option value="harvester">Harvester</option>
                                <option value="plough">Plough</option>
                                <option value="irrigation">Irrigation System</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="equipmentDescription">Description</label>
                        <textarea id="equipmentDescription" class="form-control" rows="3" placeholder="Describe the equipment"></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="equipmentPrice">Price (₹) *</label>
                            <input type="number" id="equipmentPrice" class="form-control" min="0" step="0.01" placeholder="0.00" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="priceUnit">Price Unit *</label>
                            <select id="priceUnit" class="form-control" required>
                                <option value="day">Per Day</option>
                                <option value="hour">Per Hour</option>
                                <option value="week">Per Week</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="equipmentLocation">Location *</label>
                            <input type="text" id="equipmentLocation" class="form-control" placeholder="Enter location" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="availabilityStatus">Availability Status *</label>
                            <select id="availabilityStatus" class="form-control" required>
                                <option value="available">Available</option>
                                <option value="unavailable">Unavailable</option>
                                <option value="maintenance">Under Maintenance</option>
                            </select>
                        </div>
                    </div>
                                    <!-- ADD STOCK FIELDS HERE -->
                <!-- Remove value="1" and value="5" -->
<div class="form-row">
    <div class="form-group">
        <label for="stockQuantity">Initial Stock Quantity *</label>
        <input type="number" id="stockQuantity" class="form-control" min="1" required>
        <!-- Remove: value="1" -->
    </div>
    
    <div class="form-group">
        <label for="minStockThreshold">Low Stock Alert Threshold *</label>
        <input type="number" id="minStockThreshold" class="form-control" min="1" required>
        <!-- Remove: value="5" -->
    </div>
</div>

                    <div class="form-group">
                        <label for="equipmentImage">Equipment Image</label>
                        <input type="file" id="equipmentImage" class="form-control" accept="image/*">
                        <div id="imagePreviewContainer" style="margin-top: 10px; display: none;">
                            <img id="imagePreview" src="#" alt="Image Preview" style="max-width: 100%; max-height: 200px;">
                        </div>
                    </div>
                </form>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-danger" id="cancelBtn">Cancel</button>
                <button class="btn btn-success" id="saveEquipmentBtn">Save Equipment</button>
            </div>
        </div>
    </div>

    <!-- Rent Modal -->
    <div class="modal" id="rentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Give Equipment for Rent</h3>
                <button class="close-modal">&times;</button>
            </div>
            
            <div class="modal-body">
                <form id="rentForm">
                    <input type="hidden" id="rentEquipmentId">
                    
                    <!-- Equipment Info Display -->
                    <div class="form-group" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 id="rentEquipmentName" style="margin-bottom: 10px;"></h4>
                        <p id="rentEquipmentDescription" style="margin: 0; color: var(--gray);"></p>
                    </div>
                    
                    <!-- Rent Details -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="rentPricePerDay">Price Per Day (₹) *</label>
                            <input type="number" id="rentPricePerDay" class="form-control" min="0" step="0.01" placeholder="Enter price per day" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="rentDays">Number of Days *</label>
                            <input type="number" id="rentDays" class="form-control" min="1" placeholder="Enter number of days" required>
                        </div>
                    </div>
                    
                    <!-- Total Amount Display -->
                    <div class="form-group" style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin-top: 15px;">
                        <div style="display: flex; justify-content: space-between; font-weight: bold;">
                            <span>Total Rental Amount:</span>
                            <span id="totalRentAmount">₹0</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="rentNotes">Additional Notes</label>
                        <textarea id="rentNotes" class="form-control" rows="3" placeholder="Any additional notes about this rental"></textarea>
                    </div>
                </form>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-danger" id="cancelRentBtn">Cancel</button>
                <button class="btn btn-success" id="confirmRentBtn">Confirm Rental</button>
            </div>
        </div>
    </div>

   <script>
  
    // Data storage
    let equipmentData = [];
    let bookingsData = JSON.parse(localStorage.getItem('bookingsData')) || [];
    let rentalsData = JSON.parse(localStorage.getItem('rentalsData')) || [];
    let reviewsData = JSON.parse(localStorage.getItem('reviewsData')) || [];
    let rentRequestsData = [];
    
    // DOM Elements
    const sidebar = document.getElementById('sidebar');
    const mainContent = document.getElementById('mainContent');
    const mobileMenuBtn = document.getElementById('mobileMenuBtn');
    const navLinks = document.querySelectorAll('.nav-link');
    const contentSections = document.querySelectorAll('.content-section');
    const equipmentGrid = document.getElementById('equipmentGrid');
    const recentEquipment = document.getElementById('recentEquipment');
    const recentBookingsTable = document.getElementById('recentBookingsTable');
    const bookingsTable = document.getElementById('bookingsTable');
    const reviewsContainer = document.getElementById('vendorReviewsList');
    const modal = document.getElementById('equipmentModal');
    const rentModal = document.getElementById('rentModal');
    const addEquipmentBtn = document.getElementById('addEquipmentBtn');
    const closeModalBtns = document.querySelectorAll('.close-modal');
    const cancelBtn = document.getElementById('cancelBtn');
    const cancelRentBtn = document.getElementById('cancelRentBtn');
    const saveEquipmentBtn = document.getElementById('saveEquipmentBtn');
    const confirmRentBtn = document.getElementById('confirmRentBtn');
    const modalTitle = document.getElementById('modalTitle');
    const equipmentForm = document.getElementById('equipmentForm');
    const rentForm = document.getElementById('rentForm');
    const equipmentImage = document.getElementById('equipmentImage');
    const imagePreview = document.getElementById('imagePreview');
    const imagePreviewContainer = document.getElementById('imagePreviewContainer');
    const logoutBtn = document.getElementById('logoutBtn');
    const totalEquipmentEl = document.getElementById('totalEquipment');
    const activeBookingsEl = document.getElementById('activeBookings');
    const totalCustomersEl = document.getElementById('totalCustomers');
    const averageRatingEl = document.getElementById('averageRating');
    const toast = document.getElementById('toast');
    const toastMessage = document.getElementById('toastMessage');
    const bookingFilter = document.getElementById('bookingFilter');
    const rentRequestFilter = document.getElementById('rentRequestFilter');
    
    // ================= DATABASE FUNCTIONS =================
    
    // Function to load equipment from database
    async function loadEquipmentFromDB() {
        try {
            const response = await fetch('/api/vendor/equipment');
            if (response.ok) {
                equipmentData = await response.json();
                console.log('✅ Loaded equipment from DB:', equipmentData);
                loadEquipment();
                loadRecentEquipment();
                updateStats();
            } else {
                console.error('❌ Failed to load equipment from database');
                showToast('Error loading equipment', 'error');
            }
        } catch (error) {
            console.error('❌ Error loading equipment:', error);
            showToast('Error loading equipment', 'error');
        }
    }

    // Modified saveEquipment function to handle both add and update
async function saveEquipment() {
    const id = document.getElementById('equipmentId').value;
    const name = document.getElementById('equipmentName').value;
    const category = document.getElementById('equipmentCategory').value;
    const description = document.getElementById('equipmentDescription').value;
    const price = document.getElementById('equipmentPrice').value;
    const priceUnit = document.getElementById('priceUnit').value;
    const location = document.getElementById('equipmentLocation').value;
    const status = document.getElementById('availabilityStatus').value;
    const stockQuantity = document.getElementById('stockQuantity').value;
    const minStockThreshold = document.getElementById('minStockThreshold').value;
    const imageFile = document.getElementById('equipmentImage').files[0];
    
    console.log('📦 Raw Form values:', {
        stockQuantity: stockQuantity,
        minStockThreshold: minStockThreshold,
        typeStockQuantity: typeof stockQuantity,
        typeMinStockThreshold: typeof minStockThreshold
    });
    
    // Validation - Check if fields are empty
    if (!name || !category || !price || !location || !status || !stockQuantity || !minStockThreshold) {
        showToast('Please fill in all required fields', 'error');
        return;
    }
    
    // Parse numeric values
    const parsedPrice = parseFloat(price);
    const parsedStockQuantity = parseInt(stockQuantity);
    const parsedMinStockThreshold = parseInt(minStockThreshold);
    
    console.log('📦 Parsed Form values:', {
        parsedStockQuantity: parsedStockQuantity,
        parsedMinStockThreshold: parsedMinStockThreshold
    });
    
    if (isNaN(parsedPrice) || parsedPrice <= 0) {
        showToast('Please enter a valid price', 'error');
        return;
    }
    
    if (isNaN(parsedStockQuantity) || parsedStockQuantity < 1) {
        showToast('Please enter a valid stock quantity (minimum 1)', 'error');
        return;
    }
    
    if (isNaN(parsedMinStockThreshold) || parsedMinStockThreshold < 1) {
        showToast('Please enter a valid minimum stock threshold (minimum 1)', 'error');
        return;
    }
    
    // Create FormData to handle file upload
    const formData = new FormData();
    formData.append('name', name);
    formData.append('category', category);
    formData.append('description', description);
    formData.append('price', parsedPrice);
    formData.append('price_unit', priceUnit);
    formData.append('location', location);
    formData.append('status', status);
    formData.append('stock_quantity', parsedStockQuantity);
    formData.append('min_stock_threshold', parsedMinStockThreshold);
    
    if (imageFile) {
        formData.append('image', imageFile);
    }
    
    console.log('💾 Saving equipment data:', {
        id, name, category, description, 
        price: parsedPrice, priceUnit, location, status,
        stockQuantity: parsedStockQuantity, 
        minStockThreshold: parsedMinStockThreshold,
        hasImage: !!imageFile
    });
    
    try {
        const url = id ? `/api/equipment/update/${id}` : '/api/equipment/add';
        const method = 'POST';
        
        console.log(`📤 Sending to: ${url} with method: ${method}`);
        
        const response = await fetch(url, {
            method: method,
            body: formData
        });
        
        const result = await response.json();
        console.log('📨 Response:', result);
        
        if (response.ok && result.success) {
            showToast(id ? 'Equipment updated successfully' : 'Equipment added successfully');
            modal.style.display = 'none';
            equipmentForm.reset();
            imagePreviewContainer.style.display = 'none';
            await loadEquipmentFromDB(); // Reload equipment
        } else {
            showToast(result.error || 'Error saving equipment', 'error');
        }
    } catch (error) {
        console.error('❌ Error saving equipment:', error);
        showToast('Error saving equipment', 'error');
    }
}

    // Function to delete equipment from database
    async function deleteEquipmentFromDB(id) {
        try {
            const response = await fetch(`/api/equipment/delete/${id}`, {
                method: 'POST'
            });
            
            const result = await response.json();
            
            if (response.ok && result.success) {
                return true;
            } else {
                showToast(result.error || 'Error deleting equipment', 'error');
                return false;
            }
        } catch (error) {
            console.error('Error deleting equipment:', error);
            showToast('Error deleting equipment', 'error');
            return false;
        }
    }

    // ================= EQUIPMENT MANAGEMENT =================
    
    // Function to count equipment by category
    function countEquipmentByCategory() {
        const counts = {
            tractor: 0,
            harvester: 0,
            plough: 0,
            irrigation: 0,
            other: 0
        };
        
        equipmentData.forEach(item => {
            if (item.status === 'available') {
                counts[item.category] = (counts[item.category] || 0) + 1;
            }
        });
        
        // Update the UI with counts
        document.getElementById('tractorCount').textContent = counts.tractor;
        document.getElementById('harvesterCount').textContent = counts.harvester;
        document.getElementById('ploughCount').textContent = counts.plough;
        document.getElementById('irrigationCount').textContent = counts.irrigation;
        document.getElementById('otherCount').textContent = counts.other;
    }

  // Function to update stats
async function updateStats() {
    try {
        // Update total equipment count
        totalEquipmentEl.textContent = equipmentData.length;
        
        // Load equipment counts from backend
        countEquipmentByCategory();
        
        // Fetch real booking stats
        const bookingsResponse = await fetch('/api/vendor/bookings');
        const bookings = await bookingsResponse.json();
        
        // Count active bookings (pending + confirmed)
        const activeBookingsCount = bookings.filter(booking => 
            booking.status === 'confirmed' || booking.status === 'pending'
        ).length;
        document.getElementById('activeBookings').textContent = activeBookingsCount;
        
        // Count unique customers
        const uniqueCustomers = new Set(bookings.map(booking => booking.user_id));
        document.getElementById('totalCustomers').textContent = uniqueCustomers.size;
        
        // For now, use placeholder for average rating
        // You would need to implement reviews API for this
        document.getElementById('averageRating').textContent = '4.5';
        
    } catch (error) {
        console.error('Error updating stats:', error);
        // Fallback to basic counts
        totalEquipmentEl.textContent = equipmentData.length;
        document.getElementById('activeBookings').textContent = '0';
        document.getElementById('totalCustomers').textContent = '0';
        document.getElementById('averageRating').textContent = '0.0';
    }
}
// Load vendor reviews
async function loadVendorReviews() {
    try {
        const response = await fetch('/api/vendor/reviews');
        const reviews = await response.json();
        
        const reviewsContainer = document.getElementById('vendorReviewsList');
        if (!reviewsContainer) return;
        
        reviewsContainer.innerHTML = '';
        
        if (!reviews || reviews.length === 0 || reviews.error) {
            reviewsContainer.innerHTML = `
                <div style="text-align: center; padding: 40px; color: var(--gray);">
                    <i class="fas fa-star" style="font-size: 3rem; margin-bottom: 15px;"></i>
                    <h3>No Reviews Yet</h3>
                    <p>Your equipment hasn't received any reviews yet.</p>
                </div>
            `;
            return;
        }
        
        reviews.forEach(review => {
            const reviewCard = document.createElement('div');
            reviewCard.className = 'review-card';
            
            // Create stars
            let starsHtml = '';
            for (let i = 1; i <= 5; i++) {
                starsHtml += `<i class="fas fa-star" style="color: ${i <= review.rating ? '#f59e0b' : '#e2e8f0'};"></i>`;
            }
            
            const reviewDate = new Date(review.created_date).toLocaleDateString('en-IN', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
            
            reviewCard.innerHTML = `
                <div class="review-header">
                    <div class="reviewer">${review.user_name}</div>
                    <div class="review-date">${reviewDate}</div>
                </div>
                <div class="review-rating">
                    ${starsHtml}
                </div>
                <div class="review-content">
                    <h4>${review.title}</h4>
                    <p>${review.comment}</p>
                </div>
                <div class="review-meta">
                    <small>For: ${review.equipment_name}</small>
                </div>
            `;
            
            reviewsContainer.appendChild(reviewCard);
        });
        
    } catch (error) {
        console.error('Error loading vendor reviews:', error);
    }
}
    // Equipment management functions
    function loadEquipment() {
        equipmentGrid.innerHTML = '';
        
        if (equipmentData.length === 0) {
            equipmentGrid.innerHTML = '<p class="no-data" style="text-align: center; padding: 40px; color: var(--gray);">No equipment added yet. Click the "Add Equipment" button to get started.</p>';
            return;
        }
        
        equipmentData.forEach(item => {
            const equipmentCard = createEquipmentCard(item);
            equipmentGrid.appendChild(equipmentCard);
        });
    }

   

 // In vendor dashboard JavaScript, update the createEquipmentCard function
function createEquipmentCard(item) {
    const card = document.createElement('div');
    card.className = 'item-card';
    card.dataset.id = item.id;
    
    const statusClass = 
        item.status === 'available' ? 'badge-available' : 
        item.status === 'unavailable' ? 'badge-unavailable' : 'badge-maintenance';
        
    const statusText = 
        item.status === 'available' ? 'Available' : 
        item.status === 'unavailable' ? 'Unavailable' : 'Maintenance';
    
    // Calculate stock status
    const stockQuantity = item.stock_quantity || 1;
    const minStockThreshold = item.min_stock_threshold || 5;
    
    let stockBadge = '';
    if (stockQuantity <= 0) {
        stockBadge = '<span class="item-badge badge-unavailable" style="top: 45px;">Out of Stock</span>';
    } else if (stockQuantity <= minStockThreshold) {
        stockBadge = `<span class="item-badge badge-maintenance" style="top: 45px;">Low Stock: ${stockQuantity}</span>`;
    } else {
        stockBadge = `<span class="item-badge badge-available" style="top: 45px;">In Stock: ${stockQuantity}</span>`;
    }
    
    // Handle image display
    let imageHtml = '';
    
    if (item.image_url && item.image_url !== 'None' && item.image_url !== 'null' && item.image_url.trim() !== '') {
        imageHtml = `
            <img src="${item.image_url}" alt="${item.name}" 
                 style="width: 100%; height: 100%; object-fit: cover;"
                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
            <div style="display: none; align-items: center; justify-content: center; height: 100%; background: #f5f5f5; color: var(--gray);">
                <i class="fas fa-tractor" style="font-size: 3rem;"></i>
            </div>
        `;
    } else {
        imageHtml = `
            <div style="display: flex; align-items: center; justify-content: center; height: 100%; background: #f5f5f5; color: var(--gray);">
                <i class="fas fa-tractor" style="font-size: 3rem;"></i>
            </div>
        `;
    }
    
    card.innerHTML = `
        <div class="item-img">
            ${imageHtml}
            <span class="item-badge ${statusClass}">${statusText}</span>
            ${stockBadge}
        </div>
        <div class="item-info">
            <h3>${item.name}</h3>
            <p>${item.description || 'No description available'}</p>
            <div class="item-price">₹${item.price}/${item.price_unit === 'day' ? 'day' : item.price_unit === 'hour' ? 'hour' : 'unit'}</div>
            <div class="item-meta">
                <span><i class="fas fa-map-marker-alt"></i> ${item.location}</span>
                <span><i class="fas fa-tag"></i> ${item.category}</span>
            </div>
            <div class="item-meta">
                <span><i class="fas fa-box"></i> Stock: ${stockQuantity}</span>
                <span><i class="fas fa-bell"></i> Alert: ${minStockThreshold}</span>
            </div>
            <div class="item-actions">
                <button class="btn btn-primary btn-sm edit-equipment" data-id="${item.id}">
                    <i class="fas fa-edit"></i> Edit
                </button>
                <!-- REMOVED: Manage Stock Button -->
                <button class="btn btn-success btn-sm give-for-rent" data-id="${item.id}" ${item.status !== 'available' || stockQuantity <= 0 ? 'disabled' : ''}>
                    <i class="fas fa-handshake"></i> Rent
                </button>
                <button class="btn btn-danger btn-sm delete-equipment" data-id="${item.id}">
                    <i class="fas fa-trash"></i> Delete
                </button>
            </div>
        </div>
    `;
    
    return card;
}



 // Update the openEquipmentModal function in vendor dashboard
function openEquipmentModal(editId = null) {
    if (editId) {
        modalTitle.textContent = 'Edit Equipment';
        const equipment = equipmentData.find(item => item.id == editId);
        if (equipment) {
            document.getElementById('equipmentId').value = equipment.id;
            document.getElementById('equipmentName').value = equipment.name;
            document.getElementById('equipmentCategory').value = equipment.category;
            document.getElementById('equipmentDescription').value = equipment.description || '';
            document.getElementById('equipmentPrice').value = equipment.price;
            document.getElementById('priceUnit').value = equipment.price_unit;
            document.getElementById('equipmentLocation').value = equipment.location;
            document.getElementById('availabilityStatus').value = equipment.status;
            document.getElementById('stockQuantity').value = equipment.stock_quantity || '';
            document.getElementById('minStockThreshold').value = equipment.min_stock_threshold || '';
            
            // Show existing image if available
            if (equipment.image_url && equipment.image_url !== 'None' && equipment.image_url !== 'null') {
                imagePreview.src = equipment.image_url;
                imagePreviewContainer.style.display = 'block';
            } else {
                imagePreviewContainer.style.display = 'none';
            }
        }
    } else {
        modalTitle.textContent = 'Add New Equipment';
        document.getElementById('equipmentId').value = ''; // Clear ID for new equipment
        equipmentForm.reset();
        
        // Specifically clear the stock fields for new equipment
        document.getElementById('stockQuantity').value = '';
        document.getElementById('minStockThreshold').value = '';
        
        imagePreviewContainer.style.display = 'none';
    }
    
    modal.style.display = 'flex';
}


    async function deleteEquipment(id) {
        if (confirm('Are you sure you want to delete this equipment?')) {
            const success = await deleteEquipmentFromDB(id);
            if (success) {
                // Remove from local array
                equipmentData = equipmentData.filter(item => item.id != id);
                loadEquipment();
                loadRecentEquipment();
                updateStats();
                showToast('Equipment deleted successfully');
            }
        }
    }

    // ================= RENT MODAL FUNCTIONS =================

    function openRentModal(equipmentId) {
        const equipment = equipmentData.find(item => item.id == equipmentId);
        if (equipment) {
            document.getElementById('rentEquipmentId').value = equipment.id;
            document.getElementById('rentEquipmentName').textContent = equipment.name;
            document.getElementById('rentEquipmentDescription').textContent = equipment.description;
            document.getElementById('rentPricePerDay').value = equipment.price;
            document.getElementById('rentDays').value = '';
            document.getElementById('totalRentAmount').textContent = '₹0';
            document.getElementById('rentNotes').value = '';
            
            rentModal.style.display = 'flex';
        }
    }

    function calculateTotalRent() {
        const pricePerDay = parseFloat(document.getElementById('rentPricePerDay').value) || 0;
        const days = parseInt(document.getElementById('rentDays').value) || 0;
        const totalAmount = pricePerDay * days;
        
        document.getElementById('totalRentAmount').textContent = `₹${totalAmount.toLocaleString()}`;
    }

    function confirmRental() {
        const equipmentId = document.getElementById('rentEquipmentId').value;
        const pricePerDay = parseFloat(document.getElementById('rentPricePerDay').value);
        const days = parseInt(document.getElementById('rentDays').value);
        const totalAmount = pricePerDay * days;
        const notes = document.getElementById('rentNotes').value;
        
        if (!pricePerDay || !days) {
            showToast('Please fill in all required fields', 'error');
            return;
        }
        
        const equipment = equipmentData.find(item => item.id == equipmentId);
        if (equipment) {
            // Update equipment status to unavailable
            equipment.status = 'unavailable';
            
            // Create rental record
            const rental = {
                id: Date.now(),
                equipmentId: parseInt(equipmentId),
                equipmentName: equipment.name,
                pricePerDay: pricePerDay,
                days: days,
                totalAmount: totalAmount,
                notes: notes,
                status: 'rented',
                rentedAt: new Date().toISOString()
            };
            
            rentalsData.push(rental);
            localStorage.setItem('rentalsData', JSON.stringify(rentalsData));
            
            // Update UI
            loadEquipment();
            updateStats();
            rentModal.style.display = 'none';
            rentForm.reset();
            showToast('Equipment successfully given for rent');
            
            // Update available equipment counts
            countEquipmentByCategory();
        }
    }

    // ================= BOOKINGS FUNCTIONS =================

    function loadRecentBookings() {
        recentBookingsTable.innerHTML = '';
        
        if (bookingsData.length === 0) {
            recentBookingsTable.innerHTML = `
                <tr>
                    <td colspan="5" style="text-align: center; padding: 20px; color: var(--gray);">
                        No bookings found
                    </td>
                </tr>
            `;
            return;
        }
        
        const recentBookings = bookingsData.slice(0, 5);
        
        recentBookings.forEach(booking => {
            const row = document.createElement('tr');
            
            const statusClass = 
                booking.status === 'confirmed' ? 'badge-available' : 
                booking.status === 'pending' ? 'badge-maintenance' : 
                booking.status === 'completed' ? 'badge-available' : 'badge-unavailable';
            
            row.innerHTML = `
                <td>${booking.customer}</td>
                <td>${booking.equipment}</td>
                <td>${booking.startDate} to ${booking.endDate}</td>
                <td><span class="item-badge ${statusClass}">${booking.status}</span></td>
                <td>
                    <button class="btn btn-primary btn-sm view-booking" data-id="${booking.id}">
                        <i class="fas fa-eye"></i> View
                    </button>
                </td>
            `;
            
            recentBookingsTable.appendChild(row);
        });
    }

   // ================= BOOKINGS FUNCTIONS =================

async function loadRecentBookings() {
    try {
        const response = await fetch('/api/vendor/bookings?status=pending');
        const bookings = await response.json();
        
        const tableBody = document.getElementById('recentBookingsTable');
        tableBody.innerHTML = '';
        
        if (bookings.length === 0) {
            tableBody.innerHTML = `
                <tr>
                    <td colspan="5" style="text-align: center; padding: 20px; color: var(--gray);">
                        No recent bookings found
                    </td>
                </tr>
            `;
            return;
        }
        
        // Show only recent pending bookings (last 5)
        const recentBookings = bookings.slice(0, 5);
        
        recentBookings.forEach(booking => {
            const row = document.createElement('tr');
            
            const statusClass = 
                booking.status === 'confirmed' ? 'badge-available' : 
                booking.status === 'pending' ? 'badge-maintenance' : 
                booking.status === 'completed' ? 'badge-available' : 'badge-unavailable';
            
            const bookingDate = new Date(booking.created_date).toLocaleDateString();
            
            row.innerHTML = `
                <td>${booking.user_name}</td>
                <td>${booking.equipment_name}</td>
                <td>${bookingDate}</td>
                <td><span class="item-badge ${statusClass}">${booking.status}</span></td>
                <td>
                    <button class="btn btn-primary btn-sm view-booking" data-id="${booking.id}">
                        <i class="fas fa-eye"></i> View
                    </button>
                </td>
            `;
            
            tableBody.appendChild(row);
        });
        
        // Add event listeners for view buttons
        addBookingEventListeners();
        
    } catch (error) {
        console.error('Error loading recent bookings:', error);
        document.getElementById('recentBookingsTable').innerHTML = `
            <tr>
                <td colspan="5" style="text-align: center; padding: 20px; color: var(--accent);">
                    Error loading recent bookings
                </td>
            </tr>
        `;
    }
}

async function loadAllBookings() {
    try {
        const statusFilter = document.getElementById('bookingFilter').value;
        const url = statusFilter === 'all' 
            ? '/api/vendor/bookings' 
            : `/api/vendor/bookings?status=${statusFilter}`;
            
        const response = await fetch(url);
        const bookings = await response.json();
        
        const tableBody = document.getElementById('bookingsTable');
        tableBody.innerHTML = '';
        
        if (bookings.length === 0) {
            tableBody.innerHTML = `
                <tr>
                    <td colspan="7" style="text-align: center; padding: 20px; color: var(--gray);">
                        No bookings found
                    </td>
                </tr>
            `;
            return;
        }
        
        bookings.forEach(booking => {
            const row = document.createElement('tr');
            
            const statusClass = 
                booking.status === 'confirmed' ? 'badge-available' : 
                booking.status === 'pending' ? 'badge-maintenance' : 
                booking.status === 'completed' ? 'badge-available' : 'badge-unavailable';
            
            const bookingDate = new Date(booking.created_date).toLocaleDateString();
            
            row.innerHTML = `
                <td>#${booking.id}</td>
                <td>${booking.user_name}</td>
                <td>${booking.equipment_name}</td>
                <td>${bookingDate}</td>
                <td>₹${booking.total_amount}</td>
                <td><span class="item-badge ${statusClass}">${booking.status}</span></td>
                <td>
                    <button class="btn btn-primary btn-sm view-booking" data-id="${booking.id}">
                        <i class="fas fa-eye"></i> View
                    </button>
                    ${booking.status === 'pending' ? `
                    <button class="btn btn-success btn-sm confirm-booking" data-id="${booking.id}">
                        <i class="fas fa-check"></i> Confirm
                    </button>
                    ` : ''}
                </td>
            `;
            
            tableBody.appendChild(row);
        });
        
        // Add event listeners for booking actions
        addBookingEventListeners();
        
    } catch (error) {
        console.error('Error loading bookings:', error);
        document.getElementById('bookingsTable').innerHTML = `
            <tr>
                <td colspan="7" style="text-align: center; padding: 20px; color: var(--accent);">
                    Error loading bookings
                </td>
            </tr>
        `;
    }
}

function addBookingEventListeners() {
    // View booking
    document.querySelectorAll('.view-booking').forEach(btn => {
        btn.addEventListener('click', function() {
            const bookingId = this.getAttribute('data-id');
            viewBooking(bookingId);
        });
    });
    
    // Confirm booking
    document.querySelectorAll('.confirm-booking').forEach(btn => {
        btn.addEventListener('click', function() {
            const bookingId = this.getAttribute('data-id');
            updateBookingStatus(bookingId, 'confirmed');
        });
    });
}

// ================= STOCK MANAGEMENT FUNCTIONS =================
// ADD THIS CODE AFTER YOUR EXISTING FUNCTIONS IN VENDOR DASHBOARD

// Function to update equipment stock
async function updateEquipmentStock(equipmentId, quantityChange) {
    try {
        const response = await fetch(`/api/equipment/update-stock/${equipmentId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ 
                quantity_change: quantityChange 
            })
        });
        
        if (response.ok) {
            const result = await response.json();
            console.log('✅ Stock updated successfully:', {
                equipmentId: equipmentId,
                quantityChange: quantityChange,
                newStock: result.new_stock
            });
            
            // Refresh equipment data after stock update
            await loadEquipmentFromDB();
            
            return true;
        } else {
            console.error('❌ Failed to update stock');
            return false;
        }
    } catch (error) {
        console.error('❌ Error updating stock:', error);
        return false;
    }
}

// Helper function to get rent request details
async function getRentRequestDetails(requestId) {
    try {
        const response = await fetch(`/api/vendor/rent-request/${requestId}`);
        if (response.ok) {
            return await response.json();
        }
    } catch (error) {
        console.error('Error fetching rent request details:', error);
    }
    return null;
}

// Helper function to get booking details
async function getBookingDetails(bookingId) {
    try {
        const response = await fetch(`/api/vendor/booking/${bookingId}`);
        if (response.ok) {
            return await response.json();
        }
    } catch (error) {
        console.error('Error fetching booking details:', error);
    }
    return null;
}

// UPDATE THE EXISTING updateRentRequestStatus function - REPLACE IT with this:
// Update the rent request approval function
async function updateRentRequestStatus(requestId, status) {
    try {
        let url = '';
        
        if (status === 'approved') {
            url = `/api/vendor/approve-rent-request/${requestId}`;
        } else {
            url = `/api/vendor/rent-request/${requestId}/update`;
        }
        
        const response = await fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: status !== 'approved' ? JSON.stringify({ status: status }) : null
        });
        
        if (response.ok) {
            showToast(`Rent request ${status} successfully`);
            
            // If approved, the auto-restock is automatically scheduled
            if (status === 'approved') {
                showToast('Equipment will be automatically restocked after the rental period ends.');
            }
            
            loadRentRequests(); // Reload the requests
            loadEquipmentFromDB(); // Refresh equipment data
        } else {
            showToast('Error updating rent request', 'error');
        }
    } catch (error) {
        console.error('Error updating rent request:', error);
        showToast('Error updating rent request', 'error');
    }
}

// UPDATE THE EXISTING updateBookingStatus function - REPLACE IT with this:
async function updateBookingStatus(bookingId, status) {
    try {
        const response = await fetch(`/api/vendor/booking/${bookingId}/update`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ status: status })
        });
        
        if (response.ok) {
            // If confirming a booking (purchase), decrease stock
            if (status === 'confirmed') {
                const booking = await getBookingDetails(bookingId);
                if (booking && booking.equipment_id) {
                    // For purchases, decrease by quantity (default 1)
                    const quantity = booking.quantity || 1;
                    await updateEquipmentStock(booking.equipment_id, -quantity);
                }
            }
            
            // If cancelling a confirmed booking, increase stock
            if (status === 'cancelled') {
                const booking = await getBookingDetails(bookingId);
                if (booking && booking.equipment_id && booking.status === 'confirmed') {
                    const quantity = booking.quantity || 1;
                    await updateEquipmentStock(booking.equipment_id, quantity);
                }
            }
            
            showToast(`Booking ${status} successfully`);
            loadAllBookings(); // Reload bookings
        } else {
            showToast('Error updating booking', 'error');
        }
    } catch (error) {
        console.error('Error updating booking:', error);
        showToast('Error updating booking', 'error');
    }
}
function viewBooking(bookingId) {
    // In a real app, this would show a detailed view of the booking
    alert(`Viewing booking details for #${bookingId}`);
}

    // ================= RENT REQUESTS FUNCTIONS =================

   // ================= Load Rent Requests with Return Reminder Button ==================
// ================= Load Rent Requests with Automatic Reminder Status ==================

// Update the loadRentRequests function in vendor dashboard
function loadRentRequests() {
    const container = document.querySelector('.rent-requests-list');
    const noData = document.querySelector('#rentRequestsContainer .no-data');
    
    container.innerHTML = '<p style="text-align: center; padding: 20px; color: var(--gray);">Loading rent requests...</p>';
    
    const statusFilter = document.getElementById('rentRequestFilter').value;
    
    fetch(`/api/vendor/rent-requests?status=${statusFilter}`)
        .then(response => response.json())
        .then(rentRequests => {
            container.innerHTML = '';
            
            if (rentRequests.length === 0) {
                noData.style.display = 'block';
                container.style.display = 'none';
                return;
            }
            
            noData.style.display = 'none';
            container.style.display = 'block';
            
            rentRequests.forEach(request => {
                const requestElement = createVendorRentRequestCard(request);
                container.appendChild(requestElement);
            });
            
            // Add event listeners
            addRentRequestEventListeners();
            
        })
        .catch(error => {
            console.error('❌ Error fetching rent requests:', error);
            container.innerHTML = '<p style="text-align: center; padding: 20px; color: var(--accent);">Error loading rent requests</p>';
        });
}

function createVendorRentRequestCard(request) {
    const requestElement = document.createElement('div');
    requestElement.className = 'card';
    
    const statusClass = getVendorStatusClass(request.status);
    const today = new Date();
    const endDate = new Date(request.end_date);
    const isOverdue = endDate < today;
    
    let actionButtons = '';
    
    if (request.status === 'pending') {
        actionButtons = `
            <button class="btn btn-success approve-request" data-id="${request.id}">
                <i class="fas fa-check"></i> Approve
            </button>
            <button class="btn btn-danger reject-request" data-id="${request.id}">
                <i class="fas fa-times"></i> Reject
            </button>
        `;
    } else if (request.status === 'returned') {
        actionButtons = `
            <button class="btn btn-success complete-request" data-id="${request.id}">
                <i class="fas fa-check-double"></i> Approve Return & Complete
            </button>
        `;
    } else if (request.status === 'approved' && isOverdue) {
        actionButtons = `
            <span class="item-badge badge-unavailable">Waiting for Farmer Return</span>
        `;
    }
    
    requestElement.innerHTML = `
        <div class="request-header">
            <h3 style="margin: 0;">${request.equipment_name}</h3>
            <span class="rent-status-badge ${statusClass}">${getVendorStatusText(request.status)}</span>
        </div>
        
        <div class="request-details">
            <div><strong>Customer:</strong> ${request.user_name}</div>
            <div><strong>Phone:</strong> ${request.user_phone}</div>
            <div><strong>Rental Period:</strong> ${request.start_date} to ${request.end_date}</div>
            <div><strong>Total Amount:</strong> ₹${request.total_amount}</div>
            ${isOverdue ? '<div style="color: var(--accent);"><strong>⚠️ Rental period ended</strong></div>' : ''}
        </div>
        
        <div class="request-actions">
            ${actionButtons}
        </div>
    `;
    
    return requestElement;
}

function getVendorStatusClass(status) {
    const statusClasses = {
        'pending': 'status-pending',
        'approved': 'status-approved',
        'return_pending': 'status-pending',
        'returned': 'status-pending',
        'completed': 'status-completed',
        'rejected': 'status-rejected'
    };
    return statusClasses[status] || 'status-pending';
}

function getVendorStatusText(status) {
    const statusTexts = {
        'pending': 'Pending Approval',
        'approved': 'Active Rental',
        'return_pending': 'Pending Return',
        'returned': 'Returned - Awaiting Approval',
        'completed': 'Completed',
        'rejected': 'Rejected'
    };
    return statusTexts[status] || status;
}

function addRentRequestEventListeners() {
    document.querySelectorAll('.approve-request').forEach(btn => {
        btn.addEventListener('click', function() {
            const requestId = this.getAttribute('data-id');
            updateRentRequestStatus(requestId, 'approved');
        });
    });
    
    document.querySelectorAll('.reject-request').forEach(btn => {
        btn.addEventListener('click', function() {
            const requestId = this.getAttribute('data-id');
            updateRentRequestStatus(requestId, 'rejected');
        });
    });

  // Complete request (approve return)
    document.querySelectorAll('.complete-request').forEach(btn => {
        btn.addEventListener('click', function() {
            const requestId = this.getAttribute('data-id');
            completeRentRequest(requestId);
        });
    });
}
async function completeRentRequest(requestId) {
    try {
        const response = await fetch(`/api/vendor/rent-request/${requestId}/complete`, {
            method: 'POST'
        });
        
        const result = await response.json();
        
        if (response.ok && result.success) {
            showToast('Equipment return approved! Rental completed successfully.');
            loadRentRequests(); // Reload the requests
            loadEquipmentFromDB(); // Refresh equipment data
        } else {
            showToast(result.error || 'Error completing rent request', 'error');
        }
    } catch (error) {
        console.error('Error completing rent request:', error);
        showToast('Error completing rent request', 'error');
    }
}


    async function updateRentRequestStatus(requestId, status) {
        try {
            const response = await fetch(`/api/vendor/rent-request/${requestId}/update`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ status: status })
            });
            
            if (response.ok) {
                showToast(`Rent request ${status} successfully`);
                loadRentRequests(); // Reload the requests
            } else {
                showToast('Error updating rent request', 'error');
            }
        } catch (error) {
            console.error('Error updating rent request:', error);
            showToast('Error updating rent request', 'error');
        }
    }

    // ================= REVIEWS FUNCTIONS =================

    function loadReviews() {
        reviewsContainer.innerHTML = '';
        
        if (reviewsData.length === 0) {
            reviewsContainer.innerHTML = '<p style="text-align: center; padding: 40px; color: var(--gray);">No reviews yet</p>';
            return;
        }
        
        reviewsData.forEach(review => {
            const reviewCard = document.createElement('div');
            reviewCard.className = 'review-card';
            
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                stars += `<i class="fas fa-star${i <= review.rating ? '' : '-half-alt'}"></i>`;
            }
            
            reviewCard.innerHTML = `
                <div class="review-header">
                    <div class="reviewer">${review.customer}</div>
                    <div class="review-date">${review.date}</div>
                </div>
                <div class="review-rating">
                    ${stars}
                </div>
                <div class="review-content">
                    <p>${review.comment}</p>
                </div>
                <div class="review-meta">
                    <small>For: ${review.equipment}</small>
                </div>
            `;
            
            reviewsContainer.appendChild(reviewCard);
        });
    }

    // ================= UTILITY FUNCTIONS =================

    // Toast notification function
    function showToast(message, type = 'success') {
        toastMessage.textContent = message;
        
        if (type === 'error') {
            toast.style.backgroundColor = '#e53e3e';
        } else {
            toast.style.backgroundColor = '#38a169';
        }
        
        toast.classList.add('show');
        
        setTimeout(() => {
            toast.classList.remove('show');
        }, 3000);
    }

    // Screen size check for mobile menu
    function checkScreenSize() {
        if (window.innerWidth <= 576) {
            mobileMenuBtn.style.display = 'block';
            sidebar.classList.remove('active');
        } else {
            mobileMenuBtn.style.display = 'none';
            sidebar.classList.add('active');
        }
    }

 function showSection(sectionId) {
    contentSections.forEach(section => {
        section.classList.remove('active');
    });
    
    const section = document.getElementById(`${sectionId}-section`);
    if (section) {
        section.classList.add('active');
        
        // Load data when section becomes active
        if (sectionId === 'rent-requests') {
            loadRentRequests();
        }
        if (sectionId === 'dashboard') {
            updateStats();
            loadRecentBookings(); // Load recent bookings on dashboard
        }
        if (sectionId === 'equipment') {
            loadEquipment();
        }
        if (sectionId === 'bookings') {
            loadAllBookings(); // Load all bookings when bookings section is active
        }
        if (sectionId === 'reviews') {
            loadReviews();
        }
    }
}

    function setActiveNavLink(sectionId) {
        navLinks.forEach(link => {
            link.classList.remove('active');
        });
        
        const activeLink = document.querySelector(`.nav-link[data-section="${sectionId}"]`);
        if (activeLink) {
            activeLink.classList.add('active');
        }
    }

    // ================= INITIALIZATION =================

    // Initialize the dashboard
    async function initDashboard() {
        // Load equipment from database
        await loadEquipmentFromDB();
        loadRecentBookings();
        loadAllBookings();
        loadReviews();
        updateStats();
        
        // Set active section
        const hash = window.location.hash.substring(1) || 'dashboard';
        showSection(hash);
        setActiveNavLink(hash);
        
        checkScreenSize();
        if (bookingFilter) {
            bookingFilter.addEventListener('change', filterBookings);
        }
        
        // Add rent request filter event listener
        if (rentRequestFilter) {
            rentRequestFilter.addEventListener('change', loadRentRequests);
        }
    }
// In your initialization function, add this:
if (bookingFilter) {
    bookingFilter.addEventListener('change', loadAllBookings);
}
    // ================= EVENT LISTENERS =================

    // Event Listeners
    navLinks.forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            const section = link.getAttribute('data-section');
            showSection(section);
            setActiveNavLink(section);
            window.location.hash = section;
        });
    });

    addEquipmentBtn.addEventListener('click', () => {
        openEquipmentModal(); // No ID passed for new equipment
    });

    closeModalBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            modal.style.display = 'none';
            rentModal.style.display = 'none';
        });
    });

   // Update the cancel button event listener
cancelBtn.addEventListener('click', () => {
    modal.style.display = 'none';
    equipmentForm.reset();
    // Specifically clear stock fields
    document.getElementById('stockQuantity').value = '';
    document.getElementById('minStockThreshold').value = '';
    imagePreviewContainer.style.display = 'none';
});
    cancelRentBtn.addEventListener('click', () => {
        rentModal.style.display = 'none';
        rentForm.reset();
    });

    saveEquipmentBtn.addEventListener('click', saveEquipment);
    confirmRentBtn.addEventListener('click', confirmRental);

    equipmentImage.addEventListener('change', function() {
        const file = this.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                imagePreview.src = e.target.result;
                imagePreviewContainer.style.display = 'block';
            };
            reader.readAsDataURL(file);
        } else {
            imagePreviewContainer.style.display = 'none';
        }
    });

    // Event listeners for rent calculation
    document.getElementById('rentPricePerDay').addEventListener('input', calculateTotalRent);
    document.getElementById('rentDays').addEventListener('input', calculateTotalRent);

    // Event delegation for various actions
    document.addEventListener('click', (e) => {
        // Edit equipment
        if (e.target.classList.contains('edit-equipment') || e.target.closest('.edit-equipment')) {
            const button = e.target.classList.contains('edit-equipment') ? e.target : e.target.closest('.edit-equipment');
            const id = button.getAttribute('data-id');
            openEquipmentModal(id);
        }
        
        // Delete equipment
        if (e.target.classList.contains('delete-equipment') || e.target.closest('.delete-equipment')) {
            const button = e.target.classList.contains('delete-equipment') ? e.target : e.target.closest('.delete-equipment');
            const id = button.getAttribute('data-id');
            deleteEquipment(id);
        }
        
        // Give for rent
        if (e.target.classList.contains('give-for-rent') || e.target.closest('.give-for-rent')) {
            const button = e.target.classList.contains('give-for-rent') ? e.target : e.target.closest('.give-for-rent');
            const id = button.getAttribute('data-id');
            openRentModal(id);
        }
    });

    logoutBtn.addEventListener('click', (e) => {
        e.preventDefault();
        if (confirm('Are you sure you want to logout?')) {
            window.location.href = "/logout";
        }
    });

    mobileMenuBtn.addEventListener('click', () => {
        sidebar.classList.toggle('active');
    });

    // Initialize the dashboard when the page loads
    document.addEventListener('DOMContentLoaded', initDashboard);

    // Handle window resize for responsive design
    window.addEventListener('resize', checkScreenSize);

    </script>

</body>
</html>